<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-clam/node_modules/clam/lib/page.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-clam">npmtest-clam (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-clam/node_modules/clam/lib/page.js</span></h1>
    <h2>
        
        Statements: <span class="metric">17.39% <small>(20 / 115)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 32)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">17.39% <small>(20 / 115)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-clam/node_modules/clam/lib/</a> &#187; page.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var fs = require('fs');
var path = require('path');
var mkdirp = require('mkdirp');
var J = require("juicer");
var walk = require('./util/walk.js');
var _ = require('underscore');
var iconv = require('iconv-lite');
var conf = require('./config.js');
var util = require('util');
var debug = require('debug')('clam:page');
var templateCenter = require('./template.js');
&nbsp;
var config = {
    metaDir: '.clam',
    suffix:['vm', 'php' , 'html'],
    metaFile:'page.json',
    templateDir:"../resource/page",
    template:'template.html'
};
&nbsp;
J.set("strip", false);
/**
 * 返回pages目录中的page,pageDir目录中的page需要递归获取。
 *
 * 如目录结果如下：
 * tuipiao/index.html
 * tuipiao/xxxReason/suceed.html
 * tuipiao/xxxReason/suceed.html
 * 应该返回三个页面，分别为这三个页面的全路经。
 *
 * 根据每个返回页面名获取页面额外信息，如：上线后URL
 * 每个页面可以默认有一个同名js、css文件。
 *
 * page [js/css/img/header]
 * mod  [js/css/img]
 * widget
 *
 */
exports.list = <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >    var prjInfo = conf.get('project');</span>
<span class="cstat-no" title="statement not covered" >    var root = conf.root();</span>
<span class="cstat-no" title="statement not covered" >    var pageDir = path.join(root, 'src');</span>
<span class="cstat-no" title="statement not covered" >    var metaFile = path.join(root, config.metaDir, config.metaFile);</span>
<span class="cstat-no" title="statement not covered" >    var pageFiles = walk.walkSync(pageDir);</span>
&nbsp;
    //过滤掉非html文件
<span class="cstat-no" title="statement not covered" >    var filter_page = new RegExp(path.join(root, prjInfo.pagesDir).replace(/\\/g, '/')+".+\\.html$"),</span>
        filter_root = new RegExp(path.join(root, prjInfo.pagesDir+"/..").replace(/\\/g, '/')+"/([^\/]*?)\\.html$");
<span class="cstat-no" title="statement not covered" >    pageFiles = _.filter(pageFiles, <span class="fstat-no" title="function not covered" >function (file) {</span></span>
<span class="cstat-no" title="statement not covered" >        if (file.match(filter_page)) {</span>
<span class="cstat-no" title="statement not covered" >            return true;</span>
        }
        else {
<span class="cstat-no" title="statement not covered" >            return file.match(filter_root) ? true : false;</span>
        }
    });
<span class="cstat-no" title="statement not covered" >    debug('页面%s', util.inspect(pageFiles));</span>
<span class="cstat-no" title="statement not covered" >    pageFiles = pageFiles.sort(<span class="fstat-no" title="function not covered" >function (a, b) {</span></span>
<span class="cstat-no" title="statement not covered" >        return a &lt; b;</span>
    });
<span class="cstat-no" title="statement not covered" >    var metaInfo = conf.get('page');</span>
<span class="cstat-no" title="statement not covered" >    var info = _.map(pageFiles, <span class="fstat-no" title="function not covered" >function (file) {</span></span>
<span class="cstat-no" title="statement not covered" >        var pageName = file.slice(pageDir.length+1, file.lastIndexOf('.'));</span>
<span class="cstat-no" title="statement not covered" >        var pageFileName = file.slice(pageDir.length+1, file.length);</span>
<span class="cstat-no" title="statement not covered" >        var description = '';</span>
<span class="cstat-no" title="statement not covered" >        var onlineurl = '';</span>
<span class="cstat-no" title="statement not covered" >        var pagelib = '';</span>
<span class="cstat-no" title="statement not covered" >        if(metaInfo){</span>
<span class="cstat-no" title="statement not covered" >            description = metaInfo[pageName] ? metaInfo[pageName].description : '';</span>
<span class="cstat-no" title="statement not covered" >            onlineurl = metaInfo[pageName] ? metaInfo[pageName].url : '';</span>
<span class="cstat-no" title="statement not covered" >            pagelib = metaInfo[pageName] ? metaInfo[pageName].lib : '';</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return {</span>
            name: pageName,
            file: pageFileName,
            description: description,
            url: onlineurl,
            lib: pagelib,
            fileExt: 'html'
        };
    });
<span class="cstat-no" title="statement not covered" >    return {</span>
        succeed:true,
        msg:'获取页面信息',
        data:info
    };
}
&nbsp;
/**
 * 创建页面
 * 页面创建时要根据所选框架(jquery/yui/kissy)，按照模板生成页面。
 * info 格式如下：
  {
    "url":"abcde/abc",
    "name":"abab/ddd",
    "description":"cdcd",
    "lib":["KISSY", "JQUERY", "YUI"]
   }
 */
<span class="fstat-no" title="function not covered" >function add(name, url, description, template) {</span>
<span class="cstat-no" title="statement not covered" >    var prjInfo = conf.get('project');</span>
<span class="cstat-no" title="statement not covered" >    var root = conf.root();</span>
<span class="cstat-no" title="statement not covered" >    var metaFile = path.join(root, config.metaDir, config.metaFile);</span>
<span class="cstat-no" title="statement not covered" >    var actions = [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var pageFileName = computeExt(name);</span>
    
    /**
     * 处理单页页面目录和多层页面目录结构，单层结构的都加上
     */
&nbsp;
<span class="cstat-no" title="statement not covered" >    var pagePath = path.join(root, prjInfo.pagesDir, pageFileName);</span>
    
<span class="cstat-no" title="statement not covered" >    if (fs.existsSync(pagePath)) {</span>
<span class="cstat-no" title="statement not covered" >        return {succeed:false,</span>
            msg:'存在相同的页面，创建页面失败。',
            data:pagePath
        };
    }
<span class="cstat-no" title="statement not covered" >    console.log("Creating page:"+pagePath);</span>
&nbsp;
    //创建模块HTML文件目录
<span class="cstat-no" title="statement not covered" >    var pageDir = path.join(pagePath, '..');</span>
<span class="cstat-no" title="statement not covered" >    mkdirp.sync(pageDir);</span>
&nbsp;
    //修改目录权限为775
<span class="cstat-no" title="statement not covered" >    var pageDepsdirs = pageFileName.split('/');</span>
<span class="cstat-no" title="statement not covered" >    var dir = '', j=0;</span>
<span class="cstat-no" title="statement not covered" >    for(var i = 0; i &lt; pageDepsdirs.length-1; i++){</span>
<span class="cstat-no" title="statement not covered" >        dir = path.join(conf.root(), prjInfo.pagesDir);</span>
<span class="cstat-no" title="statement not covered" >        j   = 0;</span>
<span class="cstat-no" title="statement not covered" >        while(j &lt;= i ){</span>
<span class="cstat-no" title="statement not covered" >            dir = path.join(dir, pageDepsdirs[j]);</span>
<span class="cstat-no" title="statement not covered" >            j++;</span>
        }
<span class="cstat-no" title="statement not covered" >        debug('修改目录权限%s', dir);</span>
<span class="cstat-no" title="statement not covered" >        fs.chmodSync(dir,'775');</span>
    }
&nbsp;
    //取得模板路径
<span class="cstat-no" title="statement not covered" >    if(!template){</span>
<span class="cstat-no" title="statement not covered" >        template = 'default';</span>
    }
<span class="cstat-no" title="statement not covered" >    var userHome = process.env.HOME || process.env.HOMEPATH;/</span>/兼容windows
<span class="cstat-no" title="statement not covered" >    var templateDir = path.join(userHome, '.clamconfig/templates', template,'page');</span>
<span class="cstat-no" title="statement not covered" >    if(!fs.existsSync(templateDir)){</span>
<span class="cstat-no" title="statement not covered" >        return {</span>
            succeed: false,
            msg: '模板'+template+'不存在',
            data: ''
        };
    }
&nbsp;
    //转换模板
<span class="cstat-no" title="statement not covered" >    var bn = pageDepsdirs[pageDepsdirs.length-1];</span>
<span class="cstat-no" title="statement not covered" >    var pageName = path.basename(bn, path.extname(bn));</span>
<span class="cstat-no" title="statement not covered" >    var pageInfo = {</span>
        name: pageName,
        url: url,
        description: description
    };
<span class="cstat-no" title="statement not covered" >    debug('变量信息:%s', util.inspect(pageInfo));</span>
<span class="cstat-no" title="statement not covered" >    var param = {project: prjInfo, page: pageInfo};</span>
<span class="cstat-no" title="statement not covered" >    templateCenter.convert(templateDir, pageDir, param, pageName);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    actions.push({action:'创建页面', content: pagePath});</span>
&nbsp;
    //记录page元信息
<span class="cstat-no" title="statement not covered" >    var metaInfo = conf.get('page');</span>
<span class="cstat-no" title="statement not covered" >    if(!metaInfo){</span>
<span class="cstat-no" title="statement not covered" >        metaInfo = {};</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    metaInfo[pageFileName.replace(/\.(html)$/,'')] = pageInfo;</span>
<span class="cstat-no" title="statement not covered" >    conf.set('page', metaInfo);</span>
<span class="cstat-no" title="statement not covered" >    actions.push({action:'更新页面元信息', content: metaFile});</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
        succeed: true,
        msg: '创建页面',
        data: actions
    };
}
&nbsp;
exports.add = add;
&nbsp;
/**
 * 修改页面对应的url
 */
exports.update = <span class="fstat-no" title="function not covered" >function () {</span>
&nbsp;
}
&nbsp;
/**
 * 删除页面
 */
exports.del = <span class="fstat-no" title="function not covered" >function (data) {</span>
<span class="cstat-no" title="statement not covered" >    var prjInfo = conf.get('project');</span>
<span class="cstat-no" title="statement not covered" >    var root = conf.root();</span>
<span class="cstat-no" title="statement not covered" >    var dirName = path.dirname(data.name);</span>
<span class="cstat-no" title="statement not covered" >    var fileName = path.basename(data.name);</span>
<span class="cstat-no" title="statement not covered" >    var pageDir = path.join(root, 'src', dirName);</span>
<span class="cstat-no" title="statement not covered" >    var pagePath = path.join(root, 'src', dirName, fileName + '.html');</span>
<span class="cstat-no" title="statement not covered" >    var actions = [];</span>
    //删除页面文件
<span class="cstat-no" title="statement not covered" >    fs.unlinkSync(pagePath);</span>
<span class="cstat-no" title="statement not covered" >    actions.push({action:'删除页面文件', content: pagePath});</span>
    //检查该文件夹下是否还有文件，如果没有的话就删掉
<span class="cstat-no" title="statement not covered" >    var list = fs.readdirSync(pageDir);</span>
<span class="cstat-no" title="statement not covered" >    if(list.length==0 &amp;&amp; path.basename(pageDir) != path.basename('src')){</span>
<span class="cstat-no" title="statement not covered" >        fs.rmdirSync(pageDir);</span>
<span class="cstat-no" title="statement not covered" >        actions.push({action:'删除页面文件目录', content: pagePath});</span>
    }
<span class="cstat-no" title="statement not covered" >    return {succeed:true,</span>
        msg:'删除页面',
        data:actions
    };
}
&nbsp;
//设置页面文件的扩展名，如果不是以下列表的，就改为.vm
<span class="fstat-no" title="function not covered" >function computeExt(str) {</span>
<span class="cstat-no" title="statement not covered" >    if ((/\.(html)$/).test(str)) {</span>
<span class="cstat-no" title="statement not covered" >        return str;</span>
    }
    //return str.replace(/\..*$/, "") + '.html';
<span class="cstat-no" title="statement not covered" >    return str + ".html";</span>
}
&nbsp;
//获取页面信息
<span class="fstat-no" title="function not covered" >function makePageParam(info) {</span>
<span class="cstat-no" title="statement not covered" >    var cssBase, jsBase, data;</span>
<span class="cstat-no" title="statement not covered" >    var prjInfo = conf.get('project');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var libPath = {</span>
        JQUERY:"jquery",
        ZEPTO:"zepto",
        KISSY:"s/kissy/1.3.0rc/kissy-min.js",
        YUI:"s/yui/3.5.1/build/yui/yui-min.js",
        SEAJS:"seajs"
    };
&nbsp;
    //页面的lib为空的话则取项目的lib
<span class="cstat-no" title="statement not covered" >    var jsLib = (info.lib &amp;&amp; info.lib.length) &gt; 0 ? info.lib : prjInfo.lib;</span>
&nbsp;
    //处理css reset路径
<span class="cstat-no" title="statement not covered" >    cssBase = "http://a.tbcdn.cn/??p/global/1.0/global-min.css";</span>
&nbsp;
    //处理js库
<span class="cstat-no" title="statement not covered" >    jsBase = "http://a.tbcdn.cn/??";</span>
<span class="cstat-no" title="statement not covered" >    _.each(jsLib, <span class="fstat-no" title="function not covered" >function (v, i) {</span></span>
<span class="cstat-no" title="statement not covered" >        jsBase += libPath[v] + ","</span>
    });
<span class="cstat-no" title="statement not covered" >    jsBase = jsBase.slice(0, -1);</span>
<span class="cstat-no" title="statement not covered" >    data = {</span>
        cssBase:cssBase,
        jsBase:jsBase,
        title:prjInfo.description,
        description:info.description,
        pageext: 'html',
        charset: prjInfo.charset[0]
    };
    //console.log(JSON.stringify(data));
<span class="cstat-no" title="statement not covered" >    return data</span>
}
/*
function writeFile(path,str){
    var prjInfo = conf.get('project');
    var c = iconv.encode(str,prjInfo.charset[0]);
    fs.writeFileSync(path, c);
    fs.chmodSync(path, "777");
}*/
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 20 2017 07:01:57 GMT+0000 (UTC)</div>
</div>
</body>
</html>
